(function(e){function t(t){for(var o,r,c=t[0],s=t[1],u=t[2],l=0,d=[];l<c.length;l++)r=c[l],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&d.push(i[r][0]),i[r]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);h&&h(t);while(d.length)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},i={app:0},a=[];function c(e){return s.p+"js/"+({about:"about"}[e]||e)+"."+{about:"7567a488"}[e]+".js"}function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n={about:1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=new Promise((function(t,n){for(var o="css/"+({about:"about"}[e]||e)+"."+{about:"97dd7181"}[e]+".css",i=s.p+o,a=document.getElementsByTagName("link"),c=0;c<a.length;c++){var u=a[c],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===o||l===i))return t()}var d=document.getElementsByTagName("style");for(c=0;c<d.length;c++){u=d[c],l=u.getAttribute("data-href");if(l===o||l===i)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var o=t&&t.target&&t.target.src||i,a=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=o,delete r[e],h.parentNode.removeChild(h),n(a)},h.href=i;var f=document.getElementsByTagName("head")[0];f.appendChild(h)})).then((function(){r[e]=0})));var o=i[e];if(0!==o)if(o)t.push(o[2]);else{var a=new Promise((function(t,n){o=i[e]=[t,n]}));t.push(o[2]=a);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=c(e);var d=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(h);var n=i[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",d.name="ChunkLoadError",d.type=o,d.request=r,n[1](d)}i[e]=void 0}};var h=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var h=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0613":function(e,t,n){"use strict";n.d(t,"a",(function(){return w})),n.d(t,"c",(function(){return E}));var o,r,i=n("5502"),a={loading:!1,todos:[]},c=n("ade3"),s=n("2909");n("99af");(function(e){e["SetLoading"]="SET_LOADING",e["SuccessGetTodos"]="SUCCESS_GET_TODOS"})(r||(r={}));var u,l=(o={},Object(c["a"])(o,r.SetLoading,(function(e,t){e.loading=t})),Object(c["a"])(o,r.SuccessGetTodos,(function(e,t){e.todos=[].concat(Object(s["a"])(e.todos),Object(s["a"])(t))})),o),d={},h=n("1da1"),f=(n("96cf"),n("bc3a")),p=n.n(f);(function(e){e["StartGetTodos"]="START_GET_TODOS"})(u||(u={}));var b,v=Object(c["a"])({},u.StartGetTodos,(function(e){return Object(h["a"])(regeneratorRuntime.mark((function t(){var n,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,t.prev=1,n(r.SetLoading,!0),t.next=5,p.a.get("https://jsonplaceholder.typicode.com/todos");case 5:o=t.sent,i=o.data,n(r.SuccessGetTodos,i),n(r.SetLoading,!1),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1),console.log("Error in AppActionTypes.StartGetTodos: ",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,11]])})))()})),g={state:a,mutations:l,actions:v,getters:d},m={API_ACCESS_TOKEN:"DEBUG_MODE"};(function(e){e["SET_API_ACCESS_TOKEN"]="SET_API_ACCESS_TOKEN"})(b||(b={}));var y,_=Object(c["a"])({},b.SET_API_ACCESS_TOKEN,(function(e,t){e.API_ACCESS_TOKEN=t})),O=n("9a1a");y||(y={});var k={},C={state:m,mutations:_,actions:k,getters:O["b"]},j=n("0e44"),w={APP:r,AUTH:b},S=Object(i["a"])({plugins:[Object(j["a"])()],modules:{APP:g,AUTH:C}});function E(){return S}t["b"]=S},"3e45":function(e,t,n){},"5b96":function(e,t,n){},"75fd":function(e,t,n){},"7c9d":function(e,t,n){"use strict";n("5b96")},"953f":function(e,t,n){"use strict";n("75fd")},"9a1a":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var o,r=n("ade3");(function(e){e["isAuthenticated"]="isAuthenticated"})(o||(o={}));var i=Object(r["a"])({},o.isAuthenticated,(function(e){return console.log("state.API_ACCESS_TOKEN : ",e.API_ACCESS_TOKEN),!!e.API_ACCESS_TOKEN}))},a766:function(e,t,n){},afbc:function(e,t,n){"use strict";n("d3b7"),n("3ca3"),n("ddb0"),n("7db0"),n("fb6a"),n("d81d"),n("a630"),n("159b"),n("b64b"),n("b0c0");var o=n("6c02"),r=n("7a23"),i={class:"home"},a=Object(r["f"])("br",null,null,-1);function c(e,t,n,o,c,s){var u=Object(r["w"])("SendArticleWithPositioning"),l=Object(r["w"])("PerChat");return Object(r["o"])(),Object(r["d"])("div",i,[Object(r["f"])(u),a,Object(r["f"])(l)])}var s=n("d4ec"),u=n("262e"),l=n("2caf"),d=n("9ab4"),h=n("ce1f"),f=Object(r["G"])("data-v-6bfd6b22");Object(r["s"])("data-v-6bfd6b22");var p={class:"SendArticleWithPositioning"},b=Object(r["f"])("h1",null,"Send Article With Positioning",-1),v=Object(r["f"])("label",{for:"title"},"Title",-1),g=Object(r["f"])("label",{for:"content"},"Content",-1),m=Object(r["f"])("button",{type:"submit"},"Submit",-1);Object(r["p"])();var y=f((function(e,t,n,o,i,a){return Object(r["o"])(),Object(r["d"])("div",p,[b,Object(r["f"])("form",{onSubmit:t[3]||(t[3]=Object(r["F"])((function(){return e.submitForm&&e.submitForm.apply(e,arguments)}),["prevent"]))},[v,Object(r["E"])(Object(r["f"])("input",{id:"title",type:"text","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.titleInput=t})},null,512),[[r["A"],e.titleInput]]),g,Object(r["E"])(Object(r["f"])("textarea",{id:"content",type:"text","onUpdate:modelValue":t[2]||(t[2]=function(t){return e.contentInput=t}),style:{resize:"none"}},null,512),[[r["A"],e.contentInput]]),m,Object(r["f"])("p",null,"Result : "+Object(r["y"])(e.resMessage),1)],32)])})),_=n("1da1"),O=n("bee2"),k=(n("96cf"),n("bc3a")),C=n.n(k),j=function(){function e(){Object(s["a"])(this,e)}return Object(O["a"])(e,[{key:"getPosition",value:function(){return new Promise((function(e,t){if(!navigator.geolocation)throw"Geolocation is not supported by your browser";navigator.geolocation.getCurrentPosition((function(t){var n={latitude:t.coords.latitude,longitude:t.coords.longitude};e(n)}),(function(){t("Unable to retrieve your location")}),{enableHighAccuracy:!0})}))}}]),e}(),w=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.apply(this,arguments),e.titleInput="",e.contentInput="",e.resMessage="",e}return Object(O["a"])(n,[{key:"submitForm",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(new j).getPosition();case 2:this.currentPosition=e.sent,this.sendArticleToServer({title:this.titleInput,content:this.contentInput,position:this.currentPosition});case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"sendArticleToServer",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("article : ",t),e.prev=1,e.next=4,C.a.post("/api/post_article",t);case 4:n=e.sent,console.log(n.data["result"]),this.resMessage=n.data["result"],e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),console.error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(t){return e.apply(this,arguments)}return t}()}]),n}(h["b"]);w=Object(d["a"])([Object(h["a"])({})],w);var S=w;n("7c9d");S.render=y,S.__scopeId="data-v-6bfd6b22";var E=S,T=Object(r["G"])("data-v-67dfd388");Object(r["s"])("data-v-67dfd388");var I={class:"PerChat"},D=Object(r["f"])("h1",null,"Send Article With Positioning",-1),A={class:"status_box"},R=Object(r["e"])("Connection ID: "),P=Object(r["f"])("br",null,null,-1),x=Object(r["f"])("br",null,null,-1),M={class:"message_box"};Object(r["p"])();var L=T((function(e,t,n,o,i,a){return Object(r["o"])(),Object(r["d"])("div",I,[D,Object(r["f"])("div",A,[Object(r["f"])("p",null,[R,P,Object(r["e"])(Object(r["y"])(e.recvId),1)])]),x,Object(r["f"])("div",M,[Object(r["f"])("p",null,Object(r["y"])(e.message),1)])])})),B=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(){return Object(s["a"])(this,n),t.apply(this,arguments)}return n}(h["b"]);B=Object(d["a"])([Object(h["a"])({})],B);var U=B;n("953f");U.render=L,U.__scopeId="data-v-67dfd388";var N=U,F=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(){return Object(s["a"])(this,n),t.apply(this,arguments)}return n}(h["b"]);F=Object(d["a"])([Object(h["a"])({components:{SendArticleWithPositioning:E,PerChat:N}})],F);var z=F;z.render=c;var G=z,W={class:"flex flex-row justify-center"},H={class:"ChatingBox w-3/4 children:bg-gray text-center"},V=Object(r["f"])("h1",{class:"text-4xl"},"Real Time Chating Box",-1),K={class:"border-2 border-black"},Q=Object(r["f"])("h2",null,"Connection ID:",-1),Y={class:"border-black border-2"},J=Object(r["f"])("h2",{class:"text-2xl"},"Connect To :",-1),q={class:"border-black border-2"},X=Object(r["f"])("h2",null,"Status:",-1),Z={class:"border-2 border-black"},$=Object(r["f"])("h2",{class:"text-2xl border-b-2 border-black"},"ChatRoom :",-1);function ee(e,t,n,o,i,a){return Object(r["o"])(),Object(r["d"])("div",W,[Object(r["f"])("div",H,[V,Object(r["f"])("div",K,[Q,Object(r["E"])(Object(r["f"])("p",null,Object(r["y"])(e.myPeerID),513),[[r["B"],""!==e.myPeerID]])]),Object(r["f"])("div",Y,[J,Object(r["E"])(Object(r["f"])("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.connectTarget=t}),class:"border-2 border-black"},null,512),[[r["A"],e.connectTarget]]),Object(r["f"])("button",{onClick:t[2]||(t[2]=function(){return e.DoConnect&&e.DoConnect.apply(e,arguments)}),class:"ml-2 border-2 border-black"}," Connect ")]),Object(r["f"])("div",q,[X,Object(r["f"])("p",null,Object(r["y"])(e.status),1)]),Object(r["f"])("div",null,[Object(r["E"])(Object(r["f"])("input",{"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.currentinput=t}),class:"border-black border-2",type:"text"},null,512),[[r["A"],e.currentinput]]),Object(r["f"])("button",{onClick:t[4]||(t[4]=function(){return e.SubmitMessage&&e.SubmitMessage.apply(e,arguments)}),class:"ml-2 border-2 border-black"}," Sent ")]),Object(r["f"])("div",Z,[$,(Object(r["o"])(!0),Object(r["d"])(r["a"],null,Object(r["v"])(e.chatList,(function(e,t){return Object(r["o"])(),Object(r["d"])("div",{class:"chatList text-left",key:t},Object(r["y"])(t)+" - "+Object(r["y"])(e.name)+" : "+Object(r["y"])(e.message),1)})),128))])])])}n("4ec9");var te,ne=n("3835"),oe=n("b85c"),re=n("5530"),ie=n("99de"),ae=(n("25f0"),n("99af"),n("a434"),n("e048")),ce=(n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("088b")),se=(n("caad"),n("2532"),n("09ec")),ue=new(function(){function e(){Object(s["a"])(this,e),this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return Object(O["a"])(e,[{key:"isWebRTCSupported",value:function(){return"undefined"!==typeof RTCPeerConnection}},{key:"isBrowserSupported",value:function(){var e=this.getBrowser(),t=this.getVersion(),n=this.supportedBrowsers.includes(e);return!!n&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&(!this.isIOS&&t>=this.minSafariVersion))}},{key:"getBrowser",value:function(){return se["a"].browserDetails.browser}},{key:"getVersion",value:function(){return se["a"].browserDetails.version||0}},{key:"isUnifiedPlanSupported",value:function(){var e,t=this.getBrowser(),n=se["a"].browserDetails.version||0;if("chrome"===t&&n<72)return!1;if("firefox"===t&&n>=59)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var o=!1;try{e=new RTCPeerConnection,e.addTransceiver("audio"),o=!0}catch(r){}finally{e&&e.close()}return o}},{key:"toString",value:function(){return"Supports: \n    browser:".concat(this.getBrowser()," \n    version:").concat(this.getVersion()," \n    isIOS:").concat(this.isIOS," \n    isWebRTCSupported:").concat(this.isWebRTCSupported()," \n    isBrowserSupported:").concat(this.isBrowserSupported()," \n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())}}]),e}()),le={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},de=new(function(){function e(){Object(s["a"])(this,e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=le,this.browser=ue.getBrowser(),this.browserVersion=ue.getVersion(),this.supports=function(){var e,t={browser:ue.isBrowserSupported(),webRTC:ue.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{var n;e=new RTCPeerConnection(le),t.audioVideo=!0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!ue.isIOS}catch(o){}}catch(o){}finally{n&&n.close()}}catch(o){}finally{e&&e.close()}return t}(),this.pack=ce["pack"],this.unpack=ce["unpack"],this._dataCount=1}return Object(O["a"])(e,[{key:"noop",value:function(){}},{key:"validateId",value:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)}},{key:"chunk",value:function(e){var t=[],n=e.size,o=Math.ceil(n/de.chunkedMTU),r=0,i=0;while(i<n){var a=Math.min(n,i+de.chunkedMTU),c=e.slice(i,a),s={__peerData:this._dataCount,n:r,data:c,total:o};t.push(s),i=a,r++}return this._dataCount++,t}},{key:"blobToArrayBuffer",value:function(e,t){var n=new FileReader;return n.onload=function(e){e.target&&t(e.target.result)},n.readAsArrayBuffer(e),n}},{key:"binaryStringToArrayBuffer",value:function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer}},{key:"randomToken",value:function(){return Math.random().toString(36).substr(2)}},{key:"isSecure",value:function(){return"https:"===location.protocol}}]),e}()),he=n("2909"),fe="PeerJS: ";(function(e){e[e["Disabled"]=0]="Disabled",e[e["Errors"]=1]="Errors",e[e["Warnings"]=2]="Warnings",e[e["All"]=3]="All"})(te||(te={}));var pe,be,ve,ge,me,ye,_e,Oe=function(){function e(){Object(s["a"])(this,e),this._logLevel=te.Disabled}return Object(O["a"])(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){this._logLevel=e}},{key:"log",value:function(){if(this._logLevel>=te.All){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._print.apply(this,[te.All].concat(t))}}},{key:"warn",value:function(){if(this._logLevel>=te.Warnings){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._print.apply(this,[te.Warnings].concat(t))}}},{key:"error",value:function(){if(this._logLevel>=te.Errors){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._print.apply(this,[te.Errors].concat(t))}}},{key:"setLogFunction",value:function(e){this._print=e}},{key:"_print",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var r,i=[fe].concat(n);for(var a in i)i[a]instanceof Error&&(i[a]="("+i[a].name+") "+i[a].message);if(e>=te.All)(r=console).log.apply(r,Object(he["a"])(i));else if(e>=te.Warnings){var c;(c=console).warn.apply(c,["WARNING"].concat(Object(he["a"])(i)))}else if(e>=te.Errors){var s;(s=console).error.apply(s,["ERROR"].concat(Object(he["a"])(i)))}}}]),e}(),ke=new Oe;(function(e){e["Open"]="open",e["Stream"]="stream",e["Data"]="data",e["Close"]="close",e["Error"]="error",e["IceStateChanged"]="iceStateChanged"})(pe||(pe={})),function(e){e["Data"]="data",e["Media"]="media"}(be||(be={})),function(e){e["Open"]="open",e["Close"]="close",e["Connection"]="connection",e["Call"]="call",e["Disconnected"]="disconnected",e["Error"]="error"}(ve||(ve={})),function(e){e["BrowserIncompatible"]="browser-incompatible",e["Disconnected"]="disconnected",e["InvalidID"]="invalid-id",e["InvalidKey"]="invalid-key",e["Network"]="network",e["PeerUnavailable"]="peer-unavailable",e["SslUnavailable"]="ssl-unavailable",e["ServerError"]="server-error",e["SocketError"]="socket-error",e["SocketClosed"]="socket-closed",e["UnavailableID"]="unavailable-id",e["WebRTC"]="webrtc"}(ge||(ge={})),function(e){e["Binary"]="binary",e["BinaryUTF8"]="binary-utf8",e["JSON"]="json"}(me||(me={})),function(e){e["Message"]="message",e["Disconnected"]="disconnected",e["Error"]="error",e["Close"]="close"}(ye||(ye={})),function(e){e["Heartbeat"]="HEARTBEAT",e["Candidate"]="CANDIDATE",e["Offer"]="OFFER",e["Answer"]="ANSWER",e["Open"]="OPEN",e["Error"]="ERROR",e["IdTaken"]="ID-TAKEN",e["InvalidKey"]="INVALID-KEY",e["Leave"]="LEAVE",e["Expire"]="EXPIRE"}(_e||(_e={}));var Ce=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(e,o,r,i,a){var c,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5e3;Object(s["a"])(this,n),c=t.call(this),c.pingInterval=u,c._disconnected=!0,c._messagesQueue=[];var l=e?"wss://":"ws://";return c._baseUrl=l+o+":"+r+i+"peerjs?key="+a,c}return Object(O["a"])(n,[{key:"start",value:function(e,t){var n=this;this._id=e;var o="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(t);!this._socket&&this._disconnected&&(this._socket=new WebSocket(o),this._disconnected=!1,this._socket.onmessage=function(e){var t;try{t=JSON.parse(e.data),ke.log("Server message received:",t)}catch(o){return void ke.log("Invalid server message",e.data)}n.emit(ye.Message,t)},this._socket.onclose=function(e){n._disconnected||(ke.log("Socket closed.",e),n._cleanup(),n._disconnected=!0,n.emit(ye.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),ke.log("Socket open"),n._scheduleHeartbeat())})}},{key:"_scheduleHeartbeat",value:function(){var e=this;this._wsPingTimer=setTimeout((function(){e._sendHeartbeat()}),this.pingInterval)}},{key:"_sendHeartbeat",value:function(){if(this._wsOpen()){var e=JSON.stringify({type:_e.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else ke.log("Cannot send heartbeat, because socket closed")}},{key:"_wsOpen",value:function(){return!!this._socket&&1===this._socket.readyState}},{key:"_sendQueuedMessages",value:function(){var e=Object(he["a"])(this._messagesQueue);this._messagesQueue=[];var t,n=Object(oe["a"])(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.send(o)}}catch(r){n.e(r)}finally{n.f()}}},{key:"send",value:function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(ye.Error,"Invalid message");else this._messagesQueue.push(e)}},{key:"close",value:function(){this._disconnected||(this._cleanup(),this._disconnected=!0)}},{key:"_cleanup",value:function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}]),n}(ae["EventEmitter"]),je=n("257e"),we=n("45eb"),Se=n("7e84"),Ee=function(){function e(t){Object(s["a"])(this,e),this.connection=t}return Object(O["a"])(e,[{key:"startConnection",value:function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===be.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===be.Data){var n=this.connection,o={ordered:!!e.reliable},r=t.createDataChannel(n.label,o);n.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}},{key:"_startPeerConnection",value:function(){ke.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}},{key:"_setupListeners",value:function(e){var t=this,n=this.connection.peer,o=this.connection.connectionId,r=this.connection.type,i=this.connection.provider;ke.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&(ke.log("Received ICE candidates for ".concat(n,":"),e.candidate),i.socket.send({type:_e.Candidate,payload:{candidate:e.candidate,type:r,connectionId:o},dst:n}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":ke.log("iceConnectionState is failed, closing connections to "+n),t.connection.emit(pe.Error,new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"closed":ke.log("iceConnectionState is closed, closing connections to "+n),t.connection.emit(pe.Error,new Error("Connection to "+n+" closed.")),t.connection.close();break;case"disconnected":ke.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=de.noop;break}t.connection.emit(pe.IceStateChanged,e.iceConnectionState)},ke.log("Listening for data channel"),e.ondatachannel=function(e){ke.log("Received data channel");var t=e.channel,r=i.getConnection(n,o);r.initialize(t)},ke.log("Listening for remote stream"),e.ontrack=function(e){ke.log("Received remote stream");var r=e.streams[0],a=i.getConnection(n,o);if(a.type===be.Media){var c=a;t._addStreamToMediaConnection(r,c)}}}},{key:"cleanup",value:function(){ke.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t="closed"!==e.signalingState,n=!1;if(this.connection.type===be.Data){var o=this.connection,r=o.dataChannel;r&&(n=!!r.readyState&&"closed"!==r.readyState)}(t||n)&&e.close()}}},{key:"_makeOffer",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(){var t,n,o,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.connection.peerConnection,n=this.connection.provider,e.prev=2,e.next=5,t.createOffer(this.connection.options.constraints);case 5:return o=e.sent,ke.log("Created offer."),this.connection.options.sdpTransform&&"function"===typeof this.connection.options.sdpTransform&&(o.sdp=this.connection.options.sdpTransform(o.sdp)||o.sdp),e.prev=8,e.next=11,t.setLocalDescription(o);case 11:ke.log("Set localDescription:",o,"for:".concat(this.connection.peer)),r={sdp:o,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:de.browser},this.connection.type===be.Data&&(i=this.connection,r=Object(re["a"])(Object(re["a"])({},r),{},{label:i.label,reliable:i.reliable,serialization:i.serialization})),n.socket.send({type:_e.Offer,payload:r,dst:this.connection.peer}),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](8),"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=e.t0&&(n.emitError(ge.WebRTC,e.t0),ke.log("Failed to setLocalDescription, ",e.t0));case 20:e.next=26;break;case 22:e.prev=22,e.t1=e["catch"](2),n.emitError(ge.WebRTC,e.t1),ke.log("Failed to createOffer, ",e.t1);case 26:case"end":return e.stop()}}),e,this,[[2,22],[8,17]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_makeAnswer",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.connection.peerConnection,n=this.connection.provider,e.prev=2,e.next=5,t.createAnswer();case 5:return o=e.sent,ke.log("Created answer."),this.connection.options.sdpTransform&&"function"===typeof this.connection.options.sdpTransform&&(o.sdp=this.connection.options.sdpTransform(o.sdp)||o.sdp),e.prev=8,e.next=11,t.setLocalDescription(o);case 11:ke.log("Set localDescription:",o,"for:".concat(this.connection.peer)),n.socket.send({type:_e.Answer,payload:{sdp:o,type:this.connection.type,connectionId:this.connection.connectionId,browser:de.browser},dst:this.connection.peer}),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](8),n.emitError(ge.WebRTC,e.t0),ke.log("Failed to setLocalDescription, ",e.t0);case 19:e.next=25;break;case 21:e.prev=21,e.t1=e["catch"](2),n.emitError(ge.WebRTC,e.t1),ke.log("Failed to create answer, ",e.t1);case 25:case"end":return e.stop()}}),e,this,[[2,21],[8,15]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSDP",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t,n){var o,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new RTCSessionDescription(n),o=this.connection.peerConnection,r=this.connection.provider,ke.log("Setting remote description",n),i=this,e.prev=5,e.next=8,o.setRemoteDescription(n);case 8:if(ke.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),"OFFER"!==t){e.next=12;break}return e.next=12,i._makeAnswer();case 12:e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](5),r.emitError(ge.WebRTC,e.t0),ke.log("Failed to setRemoteDescription, ",e.t0);case 18:case"end":return e.stop()}}),e,this,[[5,14]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"handleCandidate",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t){var n,o,r,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return ke.log("handleCandidate:",t),n=t.candidate,o=t.sdpMLineIndex,r=t.sdpMid,i=this.connection.peerConnection,a=this.connection.provider,e.prev=6,e.next=9,i.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:o,candidate:n}));case 9:ke.log("Added ICE candidate for:".concat(this.connection.peer)),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](6),a.emitError(ge.WebRTC,e.t0),ke.log("Failed to handleCandidate, ",e.t0);case 16:case"end":return e.stop()}}),e,this,[[6,12]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_addTracksToConnection",value:function(e,t){if(ke.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return ke.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach((function(n){t.addTrack(n,e)}))}},{key:"_addStreamToMediaConnection",value:function(e,t){ke.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)}}]),e}(),Te=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(e,o,r){var i;return Object(s["a"])(this,n),i=t.call(this),i.peer=e,i.provider=o,i.options=r,i._open=!1,i.metadata=r.metadata,i}return Object(O["a"])(n,[{key:"open",get:function(){return this._open}}]),n}(ae["EventEmitter"]),Ie=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(e,o,r){var i;return Object(s["a"])(this,n),i=t.call(this,e,o,r),i._localStream=i.options._stream,i.connectionId=i.options.connectionId||n.ID_PREFIX+de.randomToken(),i._negotiator=new Ee(Object(je["a"])(i)),i._localStream&&i._negotiator.startConnection({_stream:i._localStream,originator:!0}),i}return Object(O["a"])(n,[{key:"type",get:function(){return be.Media}},{key:"localStream",get:function(){return this._localStream}},{key:"remoteStream",get:function(){return this._remoteStream}},{key:"addStream",value:function(e){ke.log("Receiving stream",e),this._remoteStream=e,Object(we["a"])(Object(Se["a"])(n.prototype),"emit",this).call(this,pe.Stream,e)}},{key:"handleMessage",value:function(e){var t=e.type,n=e.payload;switch(e.type){case _e.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case _e.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:ke.warn("Unrecognized message type:".concat(t," from peer:").concat(this.peer));break}}},{key:"answer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._localStream)ke.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(Object(re["a"])(Object(re["a"])({},this.options._payload),{},{_stream:e}));var n,o=this.provider._getMessages(this.connectionId),r=Object(oe["a"])(o);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.handleMessage(i)}}catch(a){r.e(a)}finally{r.f()}this._open=!0}}},{key:"close",value:function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,Object(we["a"])(Object(Se["a"])(n.prototype),"emit",this).call(this,pe.Close))}}]),n}(Te);Ie.ID_PREFIX="mc_";n("c19f");var De=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.call(this),e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(t){e._processing=!1,t.target&&e.emit("done",t.target.result),e.doNextTask()},e.fileReader.onerror=function(t){ke.error("EncodingQueue error:",t),e._processing=!1,e.destroy(),e.emit("error",t)},e}return Object(O["a"])(n,[{key:"queue",get:function(){return this._queue}},{key:"size",get:function(){return this.queue.length}},{key:"processing",get:function(){return this._processing}},{key:"enque",value:function(e){this.queue.push(e),this.processing||this.doNextTask()}},{key:"destroy",value:function(){this.fileReader.abort(),this._queue=[]}},{key:"doNextTask",value:function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))}}]),n}(ae["EventEmitter"]),Ae=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(e,o,r){var i;return Object(s["a"])(this,n),i=t.call(this,e,o,r),i.stringify=JSON.stringify,i.parse=JSON.parse,i._buffer=[],i._bufferSize=0,i._buffering=!1,i._chunkedData={},i._encodingQueue=new De,i.connectionId=i.options.connectionId||n.ID_PREFIX+de.randomToken(),i.label=i.options.label||i.connectionId,i.serialization=i.options.serialization||me.Binary,i.reliable=!!i.options.reliable,i._encodingQueue.on("done",(function(e){i._bufferedSend(e)})),i._encodingQueue.on("error",(function(){ke.error("DC#".concat(i.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),i.close()})),i._negotiator=new Ee(Object(je["a"])(i)),i._negotiator.startConnection(i.options._payload||{originator:!0}),i}return Object(O["a"])(n,[{key:"type",get:function(){return be.Data}},{key:"dataChannel",get:function(){return this._dc}},{key:"bufferSize",get:function(){return this._bufferSize}},{key:"initialize",value:function(e){this._dc=e,this._configureDataChannel()}},{key:"_configureDataChannel",value:function(){var e=this;de.supports.binaryBlob&&!de.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){ke.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit(pe.Open)},this.dataChannel.onmessage=function(t){ke.log("DC#".concat(e.connectionId," dc onmessage:"),t.data),e._handleDataMessage(t)},this.dataChannel.onclose=function(){ke.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}}},{key:"_handleDataMessage",value:function(e){var t=this,o=e.data,r=o.constructor,i=this.serialization===me.Binary||this.serialization===me.BinaryUTF8,a=o;if(i){if(r===Blob)return void de.blobToArrayBuffer(o,(function(e){var n=de.unpack(e);t.emit(pe.Data,n)}));if(r===ArrayBuffer)a=de.unpack(o);else if(r===String){var c=de.binaryStringToArrayBuffer(o);a=de.unpack(c)}}else this.serialization===me.JSON&&(a=this.parse(o));a.__peerData?this._handleChunk(a):Object(we["a"])(Object(Se["a"])(n.prototype),"emit",this).call(this,pe.Data,a)}},{key:"_handleChunk",value:function(e){var t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=e.data,n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];var o=new Blob(n.data);this._handleDataMessage({data:o})}}},{key:"close",value:function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,Object(we["a"])(Object(Se["a"])(n.prototype),"emit",this).call(this,pe.Close))}},{key:"send",value:function(e,t){if(this.open)if(this.serialization===me.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===me.Binary||this.serialization===me.BinaryUTF8){var o=de.pack(e);if(!t&&o.size>de.chunkedMTU)return void this._sendChunks(o);de.supports.binaryBlob?this._bufferedSend(o):this._encodingQueue.enque(o)}else this._bufferedSend(e);else Object(we["a"])(Object(Se["a"])(n.prototype),"emit",this).call(this,pe.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))}},{key:"_bufferedSend",value:function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)}},{key:"_trySend",value:function(e){var t=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>n.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((function(){t._buffering=!1,t._tryBuffer()}),50),!1;try{this.dataChannel.send(e)}catch(o){return ke.error("DC#:".concat(this.connectionId," Error when sending:"),o),this._buffering=!0,this.close(),!1}return!0}},{key:"_tryBuffer",value:function(){if(this.open&&0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}}},{key:"_sendChunks",value:function(e){var t=de.chunk(e);ke.log("DC#".concat(this.connectionId," Try to send ").concat(t.length," chunks..."));var n,o=Object(oe["a"])(t);try{for(o.s();!(n=o.n()).done;){var r=n.value;this.send(r,!0)}}catch(i){o.e(i)}finally{o.f()}}},{key:"handleMessage",value:function(e){var t=e.payload;switch(e.type){case _e.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case _e.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:ke.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}}]),n}(Te);Ae.ID_PREFIX="dc_",Ae.MAX_BUFFERED_AMOUNT=8388608;var Re=function(){function e(t){Object(s["a"])(this,e),this._options=t}return Object(O["a"])(e,[{key:"_buildUrl",value:function(e){var t=this._options.secure?"https://":"http://",n=t+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+e,o="?ts="+(new Date).getTime()+Math.random();return n+=o,n}},{key:"retrieveId",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._buildUrl("id"),e.prev=1,e.next=4,fetch(t);case 4:if(n=e.sent,200===n.status){e.next=7;break}throw new Error("Error. Status:".concat(n.status));case 7:return e.abrupt("return",n.text());case 10:throw e.prev=10,e.t0=e["catch"](1),ke.error("Error retrieving ID",e.t0),o="","/"===this._options.path&&this._options.host!==de.CLOUD_HOST&&(o=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+o);case 16:case"end":return e.stop()}}),e,this,[[1,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"listAllPeers",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._buildUrl("peers"),e.prev=1,e.next=4,fetch(t);case 4:if(n=e.sent,200===n.status){e.next=11;break}if(401!==n.status){e.next=10;break}throw o="",o=this._options.host===de.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+o);case 10:throw new Error("Error. Status:".concat(n.status));case 11:return e.abrupt("return",n.json());case 14:throw e.prev=14,e.t0=e["catch"](1),ke.error("Error retrieving list peers",e.t0),new Error("Could not get list peers from the server."+e.t0);case 18:case"end":return e.stop()}}),e,this,[[1,14]])})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),Pe=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(e,o){var r,i;return Object(s["a"])(this,n),r=t.call(this),r._id=null,r._lastServerId=null,r._destroyed=!1,r._disconnected=!1,r._open=!1,r._connections=new Map,r._lostMessages=new Map,e&&e.constructor==Object?o=e:e&&(i=e.toString()),o=Object(re["a"])({debug:0,host:de.CLOUD_HOST,port:de.CLOUD_PORT,path:"/",key:n.DEFAULT_KEY,token:de.randomToken(),config:de.defaultConfig},o),r._options=o,"/"===r._options.host&&(r._options.host=window.location.hostname),r._options.path&&("/"!==r._options.path[0]&&(r._options.path="/"+r._options.path),"/"!==r._options.path[r._options.path.length-1]&&(r._options.path+="/")),void 0===r._options.secure&&r._options.host!==de.CLOUD_HOST?r._options.secure=de.isSecure():r._options.host==de.CLOUD_HOST&&(r._options.secure=!0),r._options.logFunction&&ke.setLogFunction(r._options.logFunction),ke.logLevel=r._options.debug||0,r._api=new Re(o),r._socket=r._createServerConnection(),de.supports.audioVideo||de.supports.data?i&&!de.validateId(i)?(r._delayedAbort(ge.InvalidID,'ID "'.concat(i,'" is invalid')),Object(ie["a"])(r)):(i?r._initialize(i):r._api.retrieveId().then((function(e){return r._initialize(e)})).catch((function(e){return r._abort(ge.ServerError,e)})),r):(r._delayedAbort(ge.BrowserIncompatible,"The current browser does not support WebRTC"),Object(ie["a"])(r))}return Object(O["a"])(n,[{key:"id",get:function(){return this._id}},{key:"options",get:function(){return this._options}},{key:"open",get:function(){return this._open}},{key:"socket",get:function(){return this._socket}},{key:"connections",get:function(){var e,t=Object.create(null),n=Object(oe["a"])(this._connections);try{for(n.s();!(e=n.n()).done;){var o=Object(ne["a"])(e.value,2),r=o[0],i=o[1];t[r]=i}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"destroyed",get:function(){return this._destroyed}},{key:"disconnected",get:function(){return this._disconnected}},{key:"_createServerConnection",value:function(){var e=this,t=new Ce(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(ye.Message,(function(t){e._handleMessage(t)})),t.on(ye.Error,(function(t){e._abort(ge.SocketError,t)})),t.on(ye.Disconnected,(function(){e.disconnected||(e.emitError(ge.Network,"Lost connection to server."),e.disconnect())})),t.on(ye.Close,(function(){e.disconnected||e._abort(ge.SocketClosed,"Underlying socket is already closed.")})),t}},{key:"_initialize",value:function(e){this._id=e,this.socket.start(e,this._options.token)}},{key:"_handleMessage",value:function(e){var t=e.type,n=e.payload,o=e.src;switch(t){case _e.Open:this._lastServerId=this.id,this._open=!0,this.emit(ve.Open,this.id);break;case _e.Error:this._abort(ge.ServerError,n.msg);break;case _e.IdTaken:this._abort(ge.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case _e.InvalidKey:this._abort(ge.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case _e.Leave:ke.log("Received leave message from ".concat(o)),this._cleanupPeer(o),this._connections.delete(o);break;case _e.Expire:this.emitError(ge.PeerUnavailable,"Could not connect to peer ".concat(o));break;case _e.Offer:var r=n.connectionId,i=this.getConnection(o,r);if(i&&(i.close(),ke.warn("Offer received for existing Connection ID:".concat(r))),n.type===be.Media)i=new Ie(o,this,{connectionId:r,_payload:n,metadata:n.metadata}),this._addConnection(o,i),this.emit(ve.Call,i);else{if(n.type!==be.Data)return void ke.warn("Received malformed connection type:".concat(n.type));i=new Ae(o,this,{connectionId:r,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable}),this._addConnection(o,i),this.emit(ve.Connection,i)}var a,c=this._getMessages(r),s=Object(oe["a"])(c);try{for(s.s();!(a=s.n()).done;){var u=a.value;i.handleMessage(u)}}catch(h){s.e(h)}finally{s.f()}break;default:if(!n)return void ke.warn("You received a malformed message from ".concat(o," of type ").concat(t));var l=n.connectionId,d=this.getConnection(o,l);d&&d.peerConnection?d.handleMessage(e):l?this._storeMessage(l,e):ke.warn("You received an unrecognized message:",e);break}}},{key:"_storeMessage",value:function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}},{key:"_getMessages",value:function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.disconnected)return ke.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(ge.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var n=new Ae(e,this,t);return this._addConnection(e,n),n}},{key:"call",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.disconnected)return ke.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(ge.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){n._stream=t;var o=new Ie(e,this,n);return this._addConnection(e,o),o}ke.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")}},{key:"_addConnection",value:function(e,t){ke.log("add connection ".concat(t.type,":").concat(t.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}},{key:"_removeConnection",value:function(e){var t=this._connections.get(e.peer);if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)}},{key:"getConnection",value:function(e,t){var n=this._connections.get(e);if(!n)return null;var o,r=Object(oe["a"])(n);try{for(r.s();!(o=r.n()).done;){var i=o.value;if(i.connectionId===t)return i}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"_delayedAbort",value:function(e,t){var n=this;setTimeout((function(){n._abort(e,t)}),0)}},{key:"_abort",value:function(e,t){ke.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}},{key:"emitError",value:function(e,t){var n;ke.error("Error:",t),n="string"===typeof t?new Error(t):t,n.type=e,this.emit(ve.Error,n)}},{key:"destroy",value:function(){this.destroyed||(ke.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(ve.Close))}},{key:"_cleanup",value:function(){var e,t=Object(oe["a"])(this._connections.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value;this._cleanupPeer(n),this._connections.delete(n)}}catch(o){t.e(o)}finally{t.f()}this.socket.removeAllListeners()}},{key:"_cleanupPeer",value:function(e){var t=this._connections.get(e);if(t){var n,o=Object(oe["a"])(t);try{for(o.s();!(n=o.n()).done;){var r=n.value;r.close()}}catch(i){o.e(i)}finally{o.f()}}}},{key:"disconnect",value:function(){if(!this.disconnected){var e=this.id;ke.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit(ve.Disconnected,e)}}},{key:"reconnect",value:function(){if(this.disconnected&&!this.destroyed)ke.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));ke.error("In a hurry? We're still trying to make the initial connection!")}}},{key:"listAllPeers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){};this._api.listAllPeers().then((function(e){return t(e)})).catch((function(t){return e._abort(ge.ServerError,t)}))}}]),n}(ae["EventEmitter"]);Pe.DEFAULT_KEY="peerjs";var xe={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun01.sipphone.com","stun:stun.ekiga.net","stun:stun.fwdnet.net","stun:stun.ideasip.com","stun:stun.iptel.org","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stunserver.org","stun:stun.softjoys.com","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org","stun:stun.xten.com"]},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"},{urls:"turn:numb.viagenie.ca",username:"webrtc@live.com",credential:"muazkh"},{urls:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{urls:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{urls:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"},{urls:"turn:turn.anyfirewall.com:443?transport=tcp",credential:"webrtc",username:"webrtc"}],sdpSemantics:"unified-plan"},Me=xe,Le=n("0613"),Be={RunningHost:"meowalien.com"},Ue=Be,Ne=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.apply(this,arguments),e.nickname="",e.status="Initializing ...",e.currentinput="",e.myPeerID="(Not generated yet ...)",e.chatList=[{name:"SYSTEM",message:"DEBUG_MESSAGE"}],e.connectTarget="",e.allConnections=new Map,e}return Object(O["a"])(n,[{key:"startPeerjs",value:function(){var e=this;console.log(Ue.RunningHost);var t=Object(Le["c"])(),n=t.state.AUTH.API_ACCESS_TOKEN;this.peer=new Pe(void 0,{host:"peerjs.localhost",port:443,path:"/",key:"peerjs",secure:!0,token:n,config:Me,debug:3}),this.peer.on(ve.Open,(function(t){console.log("On open event"),null!==t?(console.log("NewPeerID : "+t),e.myPeerID=t,e.status="Awaiting connection..."):console.log("Error : Received null id from peer open")})),this.peer.on(ve.Connection,(function(t){console.log("On connection event");try{e.appendNewConnection(t)}catch(n){return void(e.status="Fail to Connect to:"+t.peer+"Error :"+n)}e.status="Connected to: "+t.peer,console.log(e.status),t.on(pe.Data,(function(n){console.log("Data recieved: ",n),e.chatList.push({name:t.peer,message:n})})),t.on(pe.Close,(function(){e.status="Connection reset: "+t.peer,e.removeConnection(t.peer)}))})),this.peer.on(ve.Disconnected,(function(t){console.log("On disconnected event"),e.status="Disconnected with Server",console.log(e.status)})),this.peer.on(ve.Close,(function(){console.log("On close event"),e.allConnections.forEach((function(e,t){e.close()})),e.status="Connection destroyed. Please refresh",console.log("Connection destroyed")})),this.peer.on(ve.Error,(function(e){console.log("On error event"),console.log(e)}))}},{key:"appendNewConnection",value:function(e){this.allConnections.set(e.peer,e)}},{key:"removeConnection",value:function(e){this.allConnections.delete(e)}},{key:"beforeMount",value:function(){this.startPeerjs()}},{key:"SubmitMessage",value:function(){var e=this;console.log("Enter SubmitMessage"),console.log("SubmitMessage - allConnections: ",this.allConnections);var t=this.currentinput;this.currentinput="",this.chatList.push({name:"ME",message:t}),this.allConnections.forEach((function(n,o){n&&n.open?(n.send(t),console.log("Sent To: "+n.peer+" , Message: "+t)):e.removeConnection(n.peer)}))}},{key:"DoConnect",value:function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(){var t,n,o,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.connectTarget,this.connectTarget="",console.log("Try to connect to: "+t),n=this.peer.connect(t,{reliable:!0}),void 0!==n){e.next=6;break}return e.abrupt("return");case 6:o=n,this.appendNewConnection(o),o.on(pe.Open,(function(){r.status="Connected to: "+o.peer,console.log(r.status)})),o.on(pe.Data,(function(e){r.chatList.push({name:o.peer,message:e})})),o.on(pe.Close,(function(){r.status="Connection closed: "+o.peer}));case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(h["b"]);n("fb6aa");Ne.render=ee;var Fe=Ne,ze=n("9a1a"),Ge=[{path:"/",name:"Home",component:G,meta:{title:"RabbitGather",metaTags:[{name:"description",content:"RabbitGather Main page"},{property:"og:description",content:"RabbitGather Main page"}]}},{path:"/chat",name:"RealTimeChatBox",component:Fe,meta:{title:"RabbitGather - RealTimeChatBox",metaTags:[{name:"description",content:"RabbitGather - RealTimeChatBox"},{property:"og:description",content:"RabbitGather - RealTimeChatBox"}]}},{path:"/login",name:"Login",component:function(){return n.e("about").then(n.bind(null,"a55b"))},meta:{title:"RabbitGather - Login",metaTags:[{name:"description",content:"RabbitGather Login page"},{property:"og:description",content:"RabbitGather Login page"}]}}],We=Object(o["a"])({history:Object(o["b"])("/"),routes:Ge});function He(){return Object(Le["c"])().getters[ze["a"].isAuthenticated]}We.beforeEach((function(e,t,n){var o=e.matched.slice().reverse().find((function(e){return e.meta&&e.meta.title})),r=e.matched.slice().reverse().find((function(e){return e.meta&&e.meta.metaTags})),i=t.matched.slice().reverse().find((function(e){return e.meta&&e.meta.metaTags}));if(o?document.title=o.meta.title:i&&(document.title=i.meta.title),Array.from(document.querySelectorAll("[data-vue-router-controlled]")).map((function(e){return e.parentNode.removeChild(e)})),!r)return n();r.meta.metaTags.map((function(e){var t=document.createElement("meta");return Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])})),t.setAttribute("data-vue-router-controlled",""),t})).forEach((function(e){return document.head.appendChild(e)})),n()})),We.beforeEach((function(e,t,n){console.log("isAuthenticated() : "+He()),"Login"===e.name||He()?n():n({name:"Login"})}));t["a"]=We},c54d:function(e,t,n){"use strict";n("3e45")},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("7a23"),r=Object(o["e"])("Chat "),i=Object(o["e"])("Login "),a=Object(o["e"])(" Home");function c(e,t){var n=Object(o["w"])("router-link"),c=Object(o["w"])("router-view");return Object(o["o"])(),Object(o["d"])(o["a"],null,[Object(o["f"])(n,{to:"/chat"},{default:Object(o["D"])((function(){return[r]})),_:1}),Object(o["f"])(n,{to:"/login"},{default:Object(o["D"])((function(){return[i]})),_:1}),Object(o["f"])(n,{to:"/"},{default:Object(o["D"])((function(){return[a]})),_:1}),Object(o["f"])(c)],64)}n("c54d");const s={};s.render=c;var u=s,l=n("9483");Object(l["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var d=n("afbc"),h=n("0613"),f=(n("a766"),Object(o["c"])(u));f.use(h["b"]).use(d["a"]).mount("#app")},d2d9:function(e,t,n){},fb6aa:function(e,t,n){"use strict";n("d2d9")}});
//# sourceMappingURL=app.4bffdddf.js.map